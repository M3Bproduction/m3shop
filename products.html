<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Produits | M3'Shop</title>

<meta name="theme-color" content="#0d6efd">
<link rel="manifest" href="manifest.json">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="css/style.css">
</head>

<body>

<!-- NAVBAR IDENTIQUE À INDEX -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm py-2">
  <div class="container">
    <!-- LOGO -->
    <a class="navbar-brand d-flex align-items-center" href="index.html">
      <img src="images/m3shop.png"
           alt="Logo M3'Shop"
           class="logo-navbar">
    </a>

    <div class="ms-auto">
      <a href="cart.html" class="btn btn-light position-relative fw-semibold">
        <i class="bi bi-cart"></i> Panier
        <span id="cart-count" 
              class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
          0
        </span>
      </a>
    </div>
  </div>
</nav>

<!-- TITRE -->
<section class="py-5 text-center bg-light">
  <div class="container">
    <h2 class="fw-bold">Nos Produits</h2>
    <p class="text-muted">Découvrez notre sélection exclusive</p>
  </div>
</section>

<!-- BARRE DE RECHERCHE -->
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="input-group shadow-sm">
        <span class="input-group-text bg-white">
          <i class="bi bi-search"></i>
        </span>
        <input type="text" 
               id="searchInput" 
               class="form-control" 
               placeholder="Rechercher un produit...">
      </div>
    </div>
  </div>
</div>

<!-- FILTRE + TRI -->
<div class="container mt-3">
  <div class="row g-3 justify-content-center">

    <!-- Catégorie -->
    <div class="col-md-4">
      <select id="categoryFilter" class="form-select shadow-sm">
        <option value="all">Toutes les catégories</option>
        <option value="vetements">Vêtements</option>
        <option value="accessoires">Accessoires</option>
        <option value="tech">Technologie</option>
      </select>
    </div>

    <!-- Tri -->
    <div class="col-md-4">
      <select id="priceSort" class="form-select shadow-sm">
        <option value="default">Trier par prix</option>
        <option value="asc">Prix croissant</option>
        <option value="desc">Prix décroissant</option>
      </select>
    </div>

  </div>
</div>

<!-- PRODUITS -->
<div class="container py-5">
  <div class="row g-4" id="product-list"></div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Fichiers JS -->
<script src="js/products.js"></script>
<script src="js/cart.js"></script>

<script>
const container = document.getElementById("product-list");
const searchInput = document.getElementById("searchInput");
const categoryFilter = document.getElementById("categoryFilter");
const priceSort = document.getElementById("priceSort");

function displayProducts(filteredProducts) {
  container.innerHTML = "";

  if (filteredProducts.length === 0) {
    container.innerHTML = `
      <div class="col-12 text-center">
        <p class="text-muted">Aucun produit trouvé.</p>
      </div>
    `;
    return;
  }

  filteredProducts.forEach(product => {
    container.innerHTML += `
      <div class="col-md-4 col-lg-3">
        <div class="card product-card h-100 shadow-sm border-0">
          
          <div class="product-img-container">
            <img src="${product.image}" 
                 class="card-img-top product-img" 
                 alt="${product.name}">
          </div>

          <div class="card-body d-flex flex-column">
            <h6 class="fw-bold">${product.name}</h6>
            
            <p class="text-primary fw-bold fs-5 mb-3">
              ${product.price.toLocaleString()} KMF
            </p>

            <button class="btn btn-primary mt-auto"
                    onclick="addToCart(${product.id})">
              Ajouter
            </button>
          </div>

        </div>
      </div>
    `;
  });
}

function filterAndSortProducts() {

  const searchValue = searchInput.value.toLowerCase();
  const selectedCategory = categoryFilter.value;
  const sortValue = priceSort.value;

  let filtered = products.filter(product => {

    const matchName = product.name.toLowerCase().includes(searchValue);
    const matchCategory = selectedCategory === "all" || product.category === selectedCategory;

    return matchName && matchCategory;
  });

  // TRI PAR PRIX
  if (sortValue === "asc") {
    filtered.sort((a, b) => a.price - b.price);
  }

  if (sortValue === "desc") {
    filtered.sort((a, b) => b.price - a.price);
  }

  displayProducts(filtered);
}

// Initialisation
document.addEventListener("DOMContentLoaded", () => {
  displayProducts(products);

  searchInput.addEventListener("keyup", filterAndSortProducts);
  categoryFilter.addEventListener("change", filterAndSortProducts);
  priceSort.addEventListener("change", filterAndSortProducts);
});
</script>
</body>
</html>
